const bareURL="https://backendsyncdata.skycom.vn/api/spam_check/form-spam-check",urlThankReal="https://sp.jp24.vn/camon",urlThankFake="https://sp.jp24.vn/cam-on",urlSyncGoogleSheetSpam="https://script.google.com/macros/s/AKfycbzGbJQ83uGDjEGC5x8yqbIjKr0ATrzk6gNYcIxAI958cHpSfc-r6KHnylZNK7fxCpFgaQ/exec",URLFingerID="https://fpjscdn.net/v3/7aRN8UmVm1n7Qsda0mOm";let encodeName="",encodePhone="",timeNaIn=0,timeNaOut=0,timePoIn=0,timePoInLast=0,timePoOut=0,timePhoneKeydown=0,timePhoneKeyup=0,action_na_to_po_time=0,tracking_el_phone_time="";inputNameCount=0,inputPhoneCount=0,fe_check=!1,checkKeyboard=!0,isShowKeyboard=!1,note="",adsClickId="",third_id=0,count_third_id_view=1,change_3rd_id=!1,maxTouchPoints=navigator.maxTouchPoints,orientation_support=!1,touchEvent_support=!1,visitorId="",check_device_motion="",count_device_motion=0,count_device_motion_value=0;const timeFirstRenderPage=new Date,regexPhone=/^(0|\+84)(9[0-9]|3[2-9]|7[06-9]|5[6-9]|8[1-9]|2[0-9])\d{7}$/,iOSDevice=!!navigator.platform.match(/iPhone|iPod|iPad/);let parentUrl=window.location.href.indexOf("split=")>-1?window.location.href.split("split=")[1]:window.top.location.href;const inputCache=document.querySelectorAll(".input-cache"),elInputs=document.querySelectorAll(".input-cache input"),form=document.querySelector(".form-submit--skycom form");function getRandomInt(e){return Math.floor(Math.random()*e)}const number=getRandomInt(100);function textEnpty(e){return" ".repeat(e)}function encryptionIDFileds(){elInputs.forEach(((e,t)=>{const n=(Math.random()+1).toString(36).slice(2,7);0===t&&(encodeName=n),1===t&&(encodePhone=n);let o=e.getAttribute("placeholder");o+=textEnpty(100)+n+"-"+n+textEnpty(getRandomInt(20))+n+"-"+n,e.setAttribute("id",n),e.setAttribute("name",n),e.setAttribute("placeholder",o)}))}function validateForm(){const e=document.getElementById(`${encodePhone}`).value;let t=!0;return regexPhone.test(e)||(document.getElementById("errorMessage").innerText="Vui lòng nhập đúng định dạng số điện thoại",t=!1),t}encryptionIDFileds();const syncToSheetServerFail=async({name:e,phone:t,ad_channel:n,ad_account:o,link:i,reasons:a})=>{i=i.indexOf("&")>-1?i.replaceAll("&","_SKYCOM_"):i,await fetch(`${urlSyncGoogleSheetSpam}?time=${timeFirstRenderPage.toLocaleDateString()}-${timeFirstRenderPage.toLocaleTimeString()}&name=${e}&phone=${t}&utmSource=${n||""}&utmMedium=${o||""}&link=${i}&reasons=${a}&SHEET_NAME=ErrorServer`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})},syncToSheetDataSubmit=async({name:e,phone:t,ad_channel:n,ad_account:o,link:i,spam:a,reasons:c})=>{i=i.indexOf("&")>-1?i.replaceAll("&","_SKYCOM_"):i,await fetch(`${urlSyncGoogleSheetSpam}?time=${timeFirstRenderPage.toLocaleDateString()}-${timeFirstRenderPage.toLocaleTimeString()}&name=${e}&phone=${t}&utmSource=${n||""}&utmMedium=${o||""}&link=${i}&spam=${a}&reasons=${c}&SHEET_NAME=TotalSDT`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})},handlePostData=async({Ten1:e,Ten2:t,name:n,phone:o,fe_check:i,note:a,action_po_time:c,action_na_time:d,action_na_to_po_time:r,action_po_to_submit:s,tracking_el_phone_time:m,input_name_count:u,input_phone_count:l,count_third_id_view:h,change_3rd_id:_,time:p,maxTouchPoints:g,orientation_support:v,touchEvent_support:y,screen_size:f,count_device_motion:k,visitorId:w})=>{const E={Ten1:e,Ten2:t,name:n,phone:o,fe_check:i,note:a,link:parentUrl,action_po_time:c,action_na_time:d,action_na_to_po_time:r,action_po_to_submit:s,tracking_el_phone_time:m,input_name_count:u,input_phone_count:l,count_third_id_view:h,change_3rd_id:_,actionTime:p,maxTouchPoints:g,orientation_support:v,touchEvent_support:y,screen_size:f,count_device_motion:k,visitorId:w};await fetch(bareURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)}).then((e=>e.json())).then((async n=>{await syncToSheetDataSubmit({name:e,phone:t,link:parentUrl,spam:n.spam,reasons:n.reasons,ad_channel:n.ad_channel,ad_account:n.ad_account}),n.spam?window.parent.location.replace(urlThankFake):window.parent.location.replace(`${urlThankReal}?name=${e}&phone=${t}`)})).catch((async n=>{await syncToSheetServerFail({name:e,phone:t,link:parentUrl,reason:n.message,ad_channel:data.ad_channel,ad_account:data.ad_account})}))},checkCookieDisable=()=>{if(iOSDevice)return;let e=navigator.cookieEnabled;e||(document.cookie="skycomForm=skycom",e=-1!=document.cookie.indexOf("skycomForm")),e||fe_check||(fe_check=!0,note="Detect disable cookie")};function handleSubmit(){form.addEventListener("submit",(e=>{e.preventDefault(),handleCheckPhoneInputTyping();if(validateForm()){const{action_po_time:e,action_na_time:t,timeClickBuy:n,action_po_to_submit:o,action_na_to_po_time:i}=inputTiming(),a=document.getElementById(`${encodeName}`).value,c=document.getElementById(`${encodePhone}`).value,d=document.getElementById("ten2").value,r=document.getElementById("sdt2").value,s=inputPhoneCount,m=inputNameCount,u=`${window.screen.width} x ${window.screen.height}`;count_third_id_view=localStorage.getItem("count_third_id_view");const l=document.getElementById("overlay"),h=document.getElementById("btn-submit");h.innerText="ĐANG XỬ LÝ!!!",h.parentElement.classList.add("disable"),l.classList.add("active"),fe_check||1!=checkKeyboard||(fe_check=!0,note="bot sử dụng bàn phím"),handlePostData({Ten1:a,Ten2:c,name:d,phone:r,fe_check:fe_check,note:note,action_po_time:e,action_na_time:t,action_na_to_po_time:i,action_po_to_submit:o,tracking_el_phone_time:tracking_el_phone_time,input_name_count:m,input_phone_count:s,count_third_id_view:count_third_id_view,change_3rd_id:change_3rd_id,time:n,maxTouchPoints:maxTouchPoints,orientation_support:orientation_support,touchEvent_support:touchEvent_support,screen_size:u,visitorId:visitorId,count_device_motion:count_device_motion}),resetState()}}))}function randomPositionFields(){const e=document.querySelectorAll(".form-control"),t=document.getElementById(encodeName).parentElement.innerHTML,n=document.getElementById(encodePhone).parentElement.innerHTML;number%2==0?(e[0].innerHTML=t,e[1].innerHTML=n):(e[0].innerHTML=n,e[1].innerHTML=t),document.getElementById(encodeName).classList.remove("hidden"),document.getElementById(encodePhone).classList.remove("hidden")}function disableCopy(){document.getElementById(encodeName).onpaste=e=>e.preventDefault(),document.getElementById(encodePhone).onpaste=e=>e.preventDefault()}function disableEnterSubmit(){document.addEventListener("keydown",(e=>{13!==e.keyCode&&9!=e.keyCode||e.preventDefault()}))}async function syncToSheetValidate({phone:e,link:t}){t=t.indexOf("&")>-1?t.replaceAll("&","_SKYCOM_"):t,await fetch(`${urlSyncGoogleSheetSpam}?phone=${e}&link=${t}&SHEET_NAME=SDTValidate`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})}function listenEventChangeFielsValidate(){document.getElementById(encodePhone).addEventListener("input",(e=>{regexPhone.test(e.target.value)&&syncToSheetValidate({phone:e.target.value,link:parentUrl})}))}handleSubmit(),disableCopy(),disableEnterSubmit(),listenEventChangeFielsValidate();const checkProxyEnable=()=>{let e=new XMLHttpRequest;e.open("GET",window.location,!1),e.send(),e.getResponseHeader("via")&&(fe_check=!0,note="Detect disable Proxy")};checkProxyEnable();const resetState=()=>{isShowKeyboard=!1,inputPhoneCount=0},detectDevice=()=>{let e=!1,t=!1;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(t=!0,/iPhone|iPad|iPod/i.test(navigator.userAgent)&&(e=!0)),{isIOS:e,isMobile:t}},handleCheckShowKeyboard=()=>{if(!fe_check){detectDevice().isMobile&&(isShowKeyboard?fe_check=!1:(fe_check=!0,note="Bot không sử dụng bàn phím"))}},handleCheckPhoneInputTyping=()=>{if(!fe_check){detectDevice().isMobile&&(inputPhoneCount>9?fe_check=!1:(fe_check=!0,note="Bot nhập ký tự sđt dưới 9 lần"))}};"visualViewport"in window&&window.visualViewport.addEventListener("resize",(function(e){isShowKeyboard=!0}));const listenEventFocus=()=>{const e=document.querySelector(".human"),t=document.querySelector(".numeric");e?.addEventListener("focus",(e=>{timeNaIn||(timeNaIn=new Date)})),e?.addEventListener("focusout",(e=>{timeNaOut=new Date})),t?.addEventListener("focus",(e=>{timePoIn||(timePoIn=new Date),timePoInLast=new Date})),t?.addEventListener("focusout",(e=>{timePoOut=new Date}))};listenEventFocus();const inputTiming=()=>({action_po_time:Math.round(Math.abs(timePoOut-timePoIn)/1e3),action_na_time:Math.round(Math.abs(timeNaOut-timeNaIn)/1e3),timeClickBuy:Math.round(Math.abs(new Date-timeFirstRenderPage)/1e3),action_po_to_submit:Math.abs((+new Date-+timePoOut)/1e3),action_na_to_po_time:`${Math.abs((+timePoInLast-+timeNaOut)/1e3)}`}),handleCountPhoneTyping=()=>{},handleCountNameTyping=()=>{inputNameCount+=1},resetTime=()=>{timePhoneKeydown=0,timePhoneKeyup=0},trackingElPhoneTime=()=>{const e=document.getElementById(encodePhone);e.addEventListener("keydown",(()=>{timePhoneKeydown||(timePhoneKeydown=new Date)})),e.addEventListener("keyup",(()=>{timePhoneKeyup||(timePhoneKeyup=new Date),tracking_el_phone_time+=`${Math.abs((+timePhoneKeyup-+timePhoneKeydown)/1e3)}, `,timePhoneKeydown=0,timePhoneKeyup=0}))};trackingElPhoneTime();const detectAdsId=()=>{const e=parentUrl.split("&"),t=e?.find((e=>e.indexOf("utm_source")>-1));t&&(t.indexOf("facebook")>-1&&(adsClickId=e.find((e=>e.indexOf("fbclid")>-1))),(t.indexOf("youtube")>-1||t.indexOf("google")>-1)&&(adsClickId=e.find((e=>e.indexOf("gclid")>-1))),t.indexOf("tiktok")>-1&&(adsClickId=e.find((e=>e.indexOf("ttclid")>-1))),third_id=adsClickId?.split("=")[1])};detectAdsId();const countViewPage=()=>{const e="3rd_id",t="count_third_id_view";third_id&&!localStorage.getItem(e)&&localStorage.setItem(e,third_id),third_id&&(localStorage.getItem(e)!=third_id?change_3rd_id=!0:localStorage.getItem(t)?localStorage.setItem(t,Number(localStorage.getItem(t))+1):localStorage.setItem(t,count_third_id_view))};countViewPage();const checkTouchSupport=()=>{window.addEventListener("touchstart",(()=>{touchEvent_support=!0}))};window.addEventListener("touchstart",(()=>{touchEvent_support=!0}));const checkDeiceOrientation=()=>{(window.DeviceOrientationEvent||window.DeviceMotionEvent)&&(orientation_support=!0)};(window.DeviceOrientationEvent||window.DeviceMotionEvent)&&(orientation_support=!0);const createFingerID=()=>{import(URLFingerID).then((e=>e.load({region:"ap"}))).then((e=>e.get({extendedResult:!0}))).then((e=>{visitorId=e.visitorId}))};import(URLFingerID).then((e=>e.load({region:"ap"}))).then((e=>e.get({extendedResult:!0}))).then((e=>{visitorId=e.visitorId}));const checkDeviceEmotion=()=>{if(window.DeviceMotionEvent){let e=0;window.addEventListener("devicemotion",(function(t){e=t.acceleration.x||t.accelerationIncludingGravity.x})),setInterval((()=>{e!=count_device_motion_value&&count_device_motion++}),1e3)}else diff="Trình duyệt không hỗ trợ API DeviceMotion và API DeviceOrientation."};checkDeviceEmotion();const vitualKeyboard=()=>{const e=document.getElementById(encodePhone),t=document.querySelector("#skycomkeyboard");new(0,window.SimpleKeyboard.default)({onChange:t=>function(t){if(t.length>12)return void confirm("Số điện thoại quá dài");e.value=t,checkKeyboard=!1}(t),onKeyPress:e=>{inputPhoneCount++},layout:{default:["1 2 3","4 5 6","7 8 9"," 0 {bksp}"]},display:{"":"Xong","{bksp}":"xóa"},theme:"hg-theme-default hg-layout-numeric numeric-theme"});var n;!!(n=window.matchMedia||window.msMatchMedia)&&n("(pointer:coarse)").matches&&e.setAttribute("readonly","readonly");const o=document.querySelector(".hg-button[data-skbtnuid ='default-r3b0']");window.addEventListener("click",(function(n){o.contains(n.target)?(t.classList.remove("active"),inputCache[0].style.opacity="1"):e.contains(n.target)||t.contains(n.target)?(t.classList.add("active"),inputCache[0].style.opacity="0.3"):(t.classList.remove("active"),inputCache[0].style.opacity="1")}))};vitualKeyboard();