const bareURL="https://backendsyncdata.skycom.vn/api/spam_check/form-spam-check",urlThankReal="https://hoaianbeauty.com/pages/cam-on-quy-khach",urlThankFake="https://hoaianbeauty.com/pages/camon-quy-khach",urlSyncGoogleSheetSpam="https://script.google.com/macros/s/AKfycbzGbJQ83uGDjEGC5x8yqbIjKr0ATrzk6gNYcIxAI958cHpSfc-r6KHnylZNK7fxCpFgaQ/exec";let encodeName="",encodePhone="",encodeAddress="",timeAdress="",timeNaIn=0,timeNaOut=0,timePoIn=0,timePoOut=0,timePhoneKeydown=0,timePhoneKeyup=0,action_na_to_po_time=0,tracking_el_phone_time="";inputNameCount=0,inputPhoneCount=0,fe_check=!1,isShowKeyboard=!1,note="",adsClickId="",third_id=0,count_third_id=1,change_3rd_id=!1,touchEvent_supported=!1,maxTouchPoints=navigator.maxTouchPoints,orientation_support=!1;const timeFirstRenderPage=new Date,regexPhone=/^(0|\+84)(9[0-9]|3[2-9]|7[06-9]|5[6-9]|8[1-9]|2[0-9])\d{7}$/,iOSDevice=!!navigator.platform.match(/iPhone|iPod|iPad/);let parentUrl=window.location.href.indexOf("split=")>-1?window.location.href.split("split=")[1]:window.top.location.href;const elInputs=document.querySelectorAll(".input-cache input"),form=document.querySelector(".form-submit--skycom form");function getRandomInt(e){return Math.floor(Math.random()*e)}const number=getRandomInt(100);function textEnpty(e){return" ".repeat(e)}function encryptionIDFileds(){elInputs.forEach(((e,t)=>{const n=(Math.random()+1).toString(36).slice(2,7);0===t&&(encodeName=n),1===t&&(encodePhone=n),2==t&&(encodeAddress=n);let o=e.getAttribute("placeholder");o+=textEnpty(100)+n+"-"+n+textEnpty(getRandomInt(20))+n+"-"+n,e.setAttribute("id",n),e.setAttribute("name",n),e.setAttribute("placeholder",o)}))}function validateForm(){const e=document.getElementById(`${encodePhone}`).value;let t=!0;return regexPhone.test(e)||(document.getElementById("errorMessage").innerText="Vui lòng nhập đúng định dạng số điện thoại",t=!1),t}encryptionIDFileds();const syncToSheetServerFail=async({name:e,phone:t,address:n,ad_channel:o,ad_account:i,link:a,reasons:c})=>{a=a.indexOf("&")>-1?a.replaceAll("&","_SKYCOM_"):a,await fetch(`${urlSyncGoogleSheetSpam}?time=${timeFirstRenderPage.toLocaleDateString()}-${timeFirstRenderPage.toLocaleTimeString()}&name=${e}&phone=${t}&address=${n}&utmSource=${o||""}&utmMedium=${i||""}&link=${a}&reasons=${c}&SHEET_NAME=ErrorServer`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})},syncToSheetDataSubmit=async({name:e,phone:t,address:n,ad_channel:o,ad_account:i,link:a,spam:c,reasons:d})=>{a=a.indexOf("&")>-1?a.replaceAll("&","_SKYCOM_"):a,await fetch(`${urlSyncGoogleSheetSpam}?time=${timeFirstRenderPage.toLocaleDateString()}-${timeFirstRenderPage.toLocaleTimeString()}&name=${e}&phone=${t}&address=${n}&utmSource=${o||""}&utmMedium=${i||""}&link=${a}&spam=${c}&reasons=${d}&SHEET_NAME=TotalSDT`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})},handlePostData=async({Ten1:e,Ten2:t,name:n,phone:o,address:i,fe_check:a,note:c,action_po_time:d,action_na_time:r,action_ad_time:s,action_na_to_po_time:m,action_po_to_submit:l,tracking_el_phone_time:u,input_name_count:h,input_phone_count:p,count_third_id:_,change_3rd_id:g,time:y})=>{const f={Ten1:e,Ten2:t,name:n,phone:o,address:i,fe_check:a,note:c,link:parentUrl,action_po_time:d,action_na_time:r,action_ad_time:s,action_na_to_po_time:m,action_po_to_submit:l,tracking_el_phone_time:u,input_name_count:h,input_phone_count:p,count_third_id:_,change_3rd_id:g,actionTime:y};await fetch(bareURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}).then((e=>e.json())).then((async n=>{await syncToSheetDataSubmit({name:e,phone:t,link:parentUrl,address:i,spam:n.spam,reasons:n.reasons,ad_channel:n.ad_channel,ad_account:n.ad_account}),n.spam?window.parent.location.replace(urlThankFake):window.parent.location.replace(`${urlThankReal}?name=${e}&phone=${t}&address=${i}`)})).catch((async n=>{await syncToSheetServerFail({name:e,phone:t,address:i,link:parentUrl,reason:n.message,ad_channel:data.ad_channel,ad_account:data.ad_account})}))},checkCookieDisable=()=>{if(iOSDevice)return;let e=navigator.cookieEnabled;e||(document.cookie="skycomForm=skycom",e=-1!=document.cookie.indexOf("skycomForm")),e||fe_check||(fe_check=!0,note="Detect disable cookie")};function handleSubmit(){form.addEventListener("submit",(e=>{e.preventDefault(),handleCheckShowKeyboard(),handleCheckPhoneInputTyping(),checkCookieDisable();if(validateForm()){const{action_po_time:e,action_na_time:t,action_ad_time:n,timeClickBuy:o,action_po_to_submit:i,action_na_to_po_time:a}=inputTiming();inputPhoneCount,inputNameCount,document.getElementById(`${encodeName}`).value,document.getElementById(`${encodePhone}`).value,document.getElementById("ten2").value,document.getElementById("sdt2").value,document.getElementById(encodeAddress).value;count_third_id=localStorage.getItem("count_third_id");const c=document.getElementById("btn-submit");c.innerText="ĐANG XỬ LÝ!!!",c.parentElement.classList.add("disable"),alert(orientation_support)}}))}function randomPositionFields(){const e=document.querySelectorAll(".form-control"),t=document.getElementById(encodeName).parentElement.innerHTML,n=document.getElementById(encodePhone).parentElement.innerHTML;number%2==0?(e[0].innerHTML=t,e[1].innerHTML=n):(e[0].innerHTML=n,e[1].innerHTML=t),document.getElementById(encodeName).classList.remove("hidden"),document.getElementById(encodePhone).classList.remove("hidden")}function disableCopy(){document.getElementById(encodeName).onpaste=e=>e.preventDefault(),document.getElementById(encodePhone).onpaste=e=>e.preventDefault(),document.getElementById(encodeAddress).onpaste=e=>e.preventDefault()}function disableEnterSubmit(){document.addEventListener("keydown",(e=>{13!==e.keyCode&&9!=e.keyCode||e.preventDefault()}))}async function syncToSheetValidate({phone:e,link:t}){t=t.indexOf("&")>-1?t.replaceAll("&","_SKYCOM_"):t,await fetch(`${urlSyncGoogleSheetSpam}?phone=${e}&link=${t}&SHEET_NAME=SDTValidate`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})}function listenEventChangeFielsValidate(){document.getElementById(encodePhone).addEventListener("input",(e=>{regexPhone.test(e.target.value)&&syncToSheetValidate({phone:e.target.value,link:parentUrl})}))}handleSubmit(),disableCopy(),disableEnterSubmit(),listenEventChangeFielsValidate();const checkProxyEnable=()=>{let e=new XMLHttpRequest;e.open("GET",window.location,!1),e.send(),e.getResponseHeader("via")&&(fe_check=!0,note="Detect disable Proxy")};checkProxyEnable();const resetState=()=>{isShowKeyboard=!1,inputPhoneCount=0},detectDevice=()=>{let e=!1,t=!1;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(t=!0,/iPhone|iPad|iPod/i.test(navigator.userAgent)&&(e=!0)),{isIOS:e,isMobile:t}},handleCheckShowKeyboard=()=>{if(!fe_check){detectDevice().isMobile&&(isShowKeyboard?fe_check=!1:(fe_check=!0,note="Bot không sử dụng bàn phím"))}},handleCheckPhoneInputTyping=()=>{if(!fe_check){detectDevice().isMobile&&(inputPhoneCount>9?fe_check=!1:(fe_check=!0,note="Bot nhập ký tự sđt dưới 9 lần"))}};"visualViewport"in window&&window.visualViewport.addEventListener("resize",(function(e){isShowKeyboard=!0}));let timePoInLast=0;const listenEventFocus=()=>{const e=document.querySelector(".human"),t=document.querySelector(".numeric");e?.addEventListener("focus",(e=>{timeNaIn||(timeNaIn=new Date)})),e?.addEventListener("focusout",(e=>{timeNaOut=new Date})),t?.addEventListener("focus",(e=>{timePoIn||(timePoIn=new Date),timePoInLast=new Date})),t?.addEventListener("focusout",(e=>{timePoOut=new Date})),document.getElementById(encodeAddress).addEventListener("focus",(()=>{""==timeAdress&&(timeAdress=new Date)}))};listenEventFocus();const inputTiming=()=>{const e=Math.round(Math.abs(timePoOut-timePoIn)/1e3),t=Math.round(Math.abs(timeNaOut-timeNaIn)/1e3),n=Math.round(Math.abs(new Date-timeFirstRenderPage)/1e3),o=Math.abs((+new Date-+timePoOut)/1e3);return{action_po_time:e,action_na_time:t,action_ad_time:Math.round(Math.abs(new Date-timeAdress)/1e3),timeClickBuy:n,action_po_to_submit:o,action_na_to_po_time:`${Math.abs((+timePoInLast-+timeNaOut)/1e3)}`}},handleCountPhoneTyping=()=>{inputPhoneCount+=1},handleCountNameTyping=()=>{inputNameCount+=1},resetTime=()=>{timePhoneKeydown=0,timePhoneKeyup=0},trackingElPhoneTime=()=>{const e=document.getElementById(encodePhone);e.addEventListener("keydown",(()=>{timePhoneKeydown||(timePhoneKeydown=new Date)})),e.addEventListener("keyup",(()=>{timePhoneKeyup||(timePhoneKeyup=new Date),tracking_el_phone_time+=`${Math.abs((+timePhoneKeyup-+timePhoneKeydown)/1e3)}, `,timePhoneKeydown=0,timePhoneKeyup=0}))};trackingElPhoneTime();const detectAdsId=()=>{const e=parentUrl.split("&"),t=e?.find((e=>e.indexOf("utm_source")>-1));t&&(t.indexOf("facebook")>-1&&(adsClickId=e.find((e=>e.indexOf("fbclid")>-1))),(t.indexOf("youtube")>-1||t.indexOf("google")>-1)&&(adsClickId=e.find((e=>e.indexOf("gclid")>-1))),t.indexOf("tiktok")>-1&&(adsClickId=e.find((e=>e.indexOf("ttclid")>-1))),third_id=adsClickId?.split("=")[1])};detectAdsId();const countViewPage=()=>{const e="3rd_id",t="count_third_id";third_id&&!localStorage.getItem(e)&&localStorage.setItem(e,third_id),third_id&&(localStorage.getItem(e)!=third_id?change_3rd_id=!0:localStorage.getItem(t)?localStorage.setItem(t,Number(localStorage.getItem(t))+1):localStorage.setItem(t,count_third_id))};countViewPage();const checkTouchSupport=()=>{detectDevice().isMobile&&window.addEventListener("touchstart",(e=>{touchEvent_supported=!0}))};detectDevice().isMobile&&window.addEventListener("touchstart",(e=>{touchEvent_supported=!0}));const checkDeiceOrientation=()=>{(window.DeviceOrientationEvent||window.DeviceMotionEvent)&&(orientation_support=!0)};(window.DeviceOrientationEvent||window.DeviceMotionEvent)&&(orientation_support=!0);