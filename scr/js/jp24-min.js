let encodeName="",encodePhone="";const timeFirstRenderPage=new Date,regexPhone=/^(0|\+84)(9[0-9]|3[2-9]|7[06-9]|5[6-9]|8[1-9]|2[0-9])\d{7}$/;let parentUrl=window.location.href.indexOf("split=")>-1?window.location.href.split("split=")[1]:document.location.href;const bareURL="https://backendsyncdata.skycom.vn/api/spam_check/form-spam-check",urlThankReal="https://hoaianbeauty.com/pages/cam-on-quy-khach",urlThankFake="https://hoaianbeauty.com/pages/camon-quy-khach",urlSyncGoogleSheetSpam="https://script.google.com/macros/s/AKfycbzGbJQ83uGDjEGC5x8yqbIjKr0ATrzk6gNYcIxAI958cHpSfc-r6KHnylZNK7fxCpFgaQ/exec",inputCache=document.querySelectorAll(".input-cache input"),form=document.getElementById("form1");function getRandomInt(e){return Math.floor(Math.random()*e)}const number=getRandomInt(100);function textEnpty(e){return" ".repeat(e)}function encryptionIDFileds(){inputCache.forEach(((e,n)=>{const t=(Math.random()+1).toString(36).slice(2,7);0===n&&(encodeName=t),1===n&&(encodePhone=t);let a=e.getAttribute("placeholder");a+=textEnpty(100)+t+"-"+t+textEnpty(getRandomInt(20))+t+"-"+t,e.setAttribute("id",t),e.setAttribute("name",t),e.setAttribute("placeholder",a)}))}encryptionIDFileds();const syncToSheetServerFail=async({name:e,phone:n,link:t,ad_channel:a,ad_account:o,reasons:c})=>{await fetch(`${urlSyncGoogleSheetSpam}?time=${timeFirstRenderPage.toLocaleDateString()}-${timeFirstRenderPage.toLocaleTimeString()}&name=${e}&phone=${n}&utmSource=${a}&utmMedium=${o}\n        &link=${t.replaceAll("&","_SKYCOM_")}&reason=${c}&SHEET_NAME=ErrorServer`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})},syncToSheetDataSubmit=async({name:e,phone:n,link:t,ad_channel:a,ad_account:o,spam:c,reasons:i})=>{t=t.indexOf("&")>-1?t.replaceAll("&","_SKYCOM_"):t,await fetch(`${urlSyncGoogleSheetSpam}?time=${timeFirstRenderPage.toLocaleDateString()}-${timeFirstRenderPage.toLocaleTimeString()}&name=${e}&phone=${n}&link=${t}&utmSource=${a||"none"}&utmMedium=${o||"none"}\n            &spam=${c}&reasons=${i}&SHEET_NAME=TotalSDT`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})};function validateForm(){const e=document.getElementById(`${encodePhone}`).value;let n=!0;return regexPhone.test(e)||(document.getElementById("errorMessage").innerText="Vui lòng nhập đúng định dạng số điện thoại",n=!1),n}const handlePostData=async({Ten1:e,Ten2:n,name:t,phone:a,time:o})=>{const c={Ten1:e,Ten2:n,name:t,phone:a,link:parentUrl,actionTime:o};await fetch(bareURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then((e=>e.json())).then((t=>{syncToSheetDataSubmit({name:e,phone:n,link:parentUrl,spam:t.spam,reasons:t.reasons,ad_channel:t.ad_channel,ad_account:t.ad_account}),t.spam?window.parent.location.replace(urlThankFake):window.parent.location.replace(urlThankReal)})).catch((t=>{syncToSheetServerFail({name:e,phone:n,link:parentUrl,ad_channel:data.ad_channel,ad_account:data.ad_account,reason:t.message})}))};function handleSubmit(){form.addEventListener("submit",(e=>{e.preventDefault();if(validateForm()){const e=Math.round(Math.abs(new Date-timeFirstRenderPage)/1e3),n=document.getElementById(`${encodeName}`).value,t=document.getElementById(`${encodePhone}`).value,a=document.getElementById("ten2").value,o=document.getElementById("sdt2").value,c=document.getElementById("btn-submit");c.innerText="ĐANG XỬ LÝ!!!",c.parentElement.classList.add("disable"),grecaptcha.ready((function(){grecaptcha.execute(c.getAttribute("data-sitekey"),{action:"submit"}).then((function(c){handlePostData({Ten1:n,Ten2:t,name:a,phone:o,time:e})}))}))}}))}function randomPositionFields(){const e=document.querySelectorAll(".form-control"),n=document.getElementById(encodeName).parentElement.innerHTML,t=document.getElementById(encodePhone).parentElement.innerHTML;number%2==0?(e[0].innerHTML=n,e[1].innerHTML=t):(e[0].innerHTML=t,e[1].innerHTML=n),document.getElementById(encodeName).classList.remove("hidden"),document.getElementById(encodePhone).classList.remove("hidden")}function disableCopy(){document.getElementById(encodeName).onpaste=e=>e.preventDefault(),document.getElementById(encodePhone).onpaste=e=>e.preventDefault()}function disableEnterSubmit(){document.addEventListener("keydown",(e=>{13!==e.keyCode||e.preventDefault()}))}async function syncToSheetValidate({phone:e,link:n}){n=n.indexOf("&")>-1?n.replaceAll("&","_SKYCOM_"):n,await fetch(`${urlSyncGoogleSheetSpam}?phone=${e}&link=${n}&SHEET_NAME=SDTValidate`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})}function listenEventChangeFielsValidate(){document.getElementById(encodePhone).addEventListener("input",(e=>{regexPhone.test(e.target.value)&&syncToSheetValidate({phone:e.target.value,link:parentUrl})}))}handleSubmit(),randomPositionFields(),disableCopy(),disableEnterSubmit(),listenEventChangeFielsValidate();