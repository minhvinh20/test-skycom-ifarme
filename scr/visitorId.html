<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visitor ID</title>
  </head>
  <body>
    <div>
      <h3 id="visitor_id"></h3>
      <h3 id="visitor_confidence"></h3>
      <h3 id="is_bot"></h3>
      <h3 id="bot_confidence"></h3>
    </div>
    <script src="https://openfpcdn.io/fingerprintjs/v4/iife.min.js"></script>
    <script>
        var urlVisitor = 'https://fingerprint.skycom.vn/api/v1/visits/';
        var Params ={
          url: window.location.href,
          components: {},
          organization_id: "651694c9a640a613161edcd5",
          browser_vid: localStorage.getItem("browser_vid") || null ,
          is_bot: null
        }
        async function getComponentsVisitorID() {
          var fpPromise =  FingerprintJS.load();
          fpPromise
            .then((fp) => fp.get())
            .then(async function(result) {
              Params.components  = await result.components;
              localStorage.setItem("browser_vid", result.visitorId)
            })
        }
        async function checkBot () {
          var botdPromise = import('https://openfpcdn.io/botd/v1').then((Botd) => Botd.load())
          botdPromise
            .then((botd) => botd.detect())
            .then(async function (result) {
              Params.is_bot = await result.bot;
            })
        }
        async function handlePostVisitorID() {
          var result= await fetch(urlVisitor, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(Params),
          })
          .then(function (response) {
            return response.json();
          })
          .then(async function (response) {
            let data = response.data;
            document.getElementById("visitor_id").innerHTML = `visitor_id: ${data.visitor_id}`
            document.getElementById("visitor_confidence").innerHTML = `visitor_confidence: ${data.visitor_confidence * 100}%`
            document.getElementById("is_bot").innerHTML = `is_bot: ${data.is_bot}`
            document.getElementById("bot_confidence").innerHTML = `bot_confidence: ${data.bot_confidence * 100}%`
          })
        }

        getComponentsVisitorID();
        checkBot();
        setTimeout(() => {
          handlePostVisitorID();
        }, 1000);
    </script>
  </body>
</html>
