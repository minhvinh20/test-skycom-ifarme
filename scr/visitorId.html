<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visitor ID</title>
  </head>
  <body>

    <Button id="detect-visitorid">Detect VisitorID</Button>

    <script src="https://openfpcdn.io/fingerprintjs/v4/iife.min.js"></script>
    <script>
        var urlVisitor = 'https://fingerprint.skycom.vn/api/v1/visits/';
        var Params ={
          url: window.location.href,
          components: {},
          organization_id: "651694c9a640a613161edcd5",
          browser_vid: localStorage.getItem("browser_vid") || null ,
          is_bot: null
        }
        async function getComponentsVisitorID() {
          var fpPromise =  FingerprintJS.load();
          fpPromise
            .then((fp) => fp.get())
            .then(async function(result) {
              Params.components  = await result.components;
            })
        }
        async function checkBot () {
          var botdPromise = import('https://openfpcdn.io/botd/v1').then((Botd) => Botd.load())
          botdPromise
            .then((botd) => botd.detect())
            .then(async function (result) {
              Params.is_bot = await result.bot;
            })
        }
        async function handlePostVisitorID() {
          var result= await fetch(urlVisitor, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(Params),
          })
          result.then(function (response) {
            return response.json();
          })
          .then(async function (data) {
            console.log('data', data)
          })
        }

        getComponentsVisitorID();
        checkBot();
        document.getElementById("detect-visitorid").addEventListener('click', (e )=>{
          handlePostVisitorID();
        })

    </script>
  </body>
</html>
