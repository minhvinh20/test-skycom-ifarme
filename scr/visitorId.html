<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visitor ID</title>
  </head>
  <body>
    <h1>Visitor ID: <span id="id"></span></h1>

    <script src="https://openfpcdn.io/fingerprintjs/v4/iife.min.js"></script>
    <script>
      var mimeTypes_suffixes = '';
      var mimeTypes_type1 = '';
      var mimeTypes_type2 = '';
      var fpPromise = FingerprintJS.load();
      fpPromise
        .then((fp) => fp.get({ extendedResult: true }))
        .then((result) => {
          console.log("result", result);
          const components = result.components;
          if (components.plugins.value[0].mimeTypes[0] || components.plugins.value[0].mimeTypes[1]) {
            mimeTypes_suffixes = components.plugins.value[0].mimeTypes[0].suffixes;
            mimeTypes_type1 = components.plugins.value[0].mimeTypes[0].type;
            mimeTypes_type2 = components.plugins.value[0].mimeTypes[1].type;
          }
          const stringHash =
            components.webGlExtensions.value.contextAttributes.toString() +
            components.webGlExtensions.value.extensionParameters.toString() +
            components.webGlExtensions.value.extensions.toString() +
            components.webGlExtensions.value.parameters.toString() +
            components.webGlExtensions.value.shaderPrecisions.toString() +
            components.webGlBasics.value.renderer +
            components.webGlBasics.value.rendererUnmasked +
            components.webGlBasics.value.shadingLanguageVersion +
            components.webGlBasics.value.vendor +
            components.webGlBasics.value.vendorUnmasked +
            components.webGlBasics.value.version +
            components.fonts.value.toString()+
            components.fontPreferences.value.toString() +
            components.screenResolution.value.toString() +
            components.deviceMemory.value +
            components.audio.value +
            components.canvas.value.geometry;

          function getHash(str, algo = "SHA-256") {
            let strBuf = new TextEncoder().encode(str);
            return crypto.subtle.digest(algo, strBuf).then((hash) => {
              window.hash = hash;
              let stringHash = "";
              const view = new DataView(hash);
              for (let i = 0; i < hash.byteLength; i += 4) {
                stringHash += view.getUint16(i).toString(16).slice(-8);
              }
              return stringHash;
            });
          }
          getHash(stringHash).then((hash) => {
            document.getElementById("id").innerHTML = hash;
          });
        });
    </script>
  </body>
</html>
