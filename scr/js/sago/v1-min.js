const bareURL="https://devsyncdata.skycom.vn/api/spam_check/form-spam-check",urlThankReal="https://hoaianbeauty.com/pages/cam-on-quy-khach",urlThankFake="https://hoaianbeauty.com/pages/camon-quy-khach",urlSyncGoogleSheetSpam="https://script.google.com/macros/s/AKfycbxLfcxEvDuRrXtifkRBMz2wNMsW9nc041FCB0i6Zn_xn1EkdPqHT69DsfrkEYbD49Lf/exec",URLFingerID="https://fpjscdn.net/v3/7aRN8UmVm1n7Qsda0mOm",timeFirstRenderPage=new Date,regexPhone=/^(0|\+84)(9[0-9]|3[2-9]|7[06-9]|5[6-9]|8[1-9]|2[0-9])\d{7}$/;let parentUrl=window.location.href.indexOf("split=")>-1?window.location.href.split("split=")[1]:window.location.href,elInputs=document.querySelectorAll(".input-cache input"),form=document.querySelector(".form-submit--skycom form"),overlay=document.getElementById("overlay"),buttonSubmit=document.getElementById("btn-submit"),encodeName="",encodePhone="",isKeyboardOpen=0,Count_na_keyboard=0,Count_na_delete_keyboard=[],Is_open_na_keyboard=null,Action_na_time=0,Count_po_keyboard=0,Action_po_time=0,Action_po_to_submit=0,Is_open_po_keyboard=null,Count_po_delete_keyboard=[],Action_time=0,Action_form_time=0,Skl_vistorID=null,visitorId=null,adsClickId="",third_id=0,Count_3rd_id=1,Change_3rd_id=!1,Sceensize="",Touch_pixel=[],Is_device_motion_change=null;function detectDevice(){let e=!1,t=!1;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(t=!0,/iPhone|iPad|iPod/i.test(navigator.userAgent)&&(e=!0)),{isIOS:e,isMobile:t}}function listenerKeyboardOpen(){return window.innerWidth<768&&window.screen.height-280>window.visualViewport.height&&(isKeyboardOpen=!0),isKeyboardOpen}function getRandomInt(e){return Math.floor(Math.random()*e)}function textEnpty(e){return" ".repeat(e)}function encryptionIDFileds(){elInputs.forEach(((e,t)=>{const n=(Math.random()+1).toString(36).slice(2,7);0===t&&(encodeName=n),1===t&&(encodePhone=n);let o=e.getAttribute("placeholder");o+=textEnpty(100)+n+"-"+n+textEnpty(getRandomInt(20))+n+"-"+n,e.setAttribute("id",n),e.setAttribute("name",n),e.setAttribute("placeholder",o)}))}encryptionIDFileds();const fieldName=document.getElementById(encodeName),fieldPhone=document.getElementById(encodePhone);function disableEnterSubmit(){document.addEventListener("keydown",(e=>{13!==e.keyCode&&9!=e.keyCode||e.preventDefault()}))}function disableCopy(){fieldName.onpaste=function(e){e.preventDefault()},fieldPhone.onpaste=function(e){e.preventDefault()}}function checkTouchSupport(){window.addEventListener("touchstart",(function(e){for(let t=0;t<e.touches.length;t++){const n=e.touches[t].screenX.toFixed(2),o=e.touches[t].screenY.toFixed(2);Touch_pixel.push(`${n}_${o}`)}}))}function getHash(e,t="SHA-256"){let n=(new TextEncoder).encode(e);return crypto.subtle.digest(t,n).then((e=>{window.hash=e;let t="";const n=new DataView(e);for(let o=0;o<e.byteLength;o+=4)t+=n.getUint16(o).toString(16).slice(-8);return t}))}disableEnterSubmit(),disableCopy(),checkTouchSupport();const createSklVisitorIdByFinger=()=>{FingerprintJS.load().then((async e=>await e.get({extendedResult:!0}))).then((e=>{const t=e.components;getHash(t.deviceMemory.value+t.audio.value+t.webGlExtensions.value.contextAttributes.toString()+t.webGlExtensions.value.extensionParameters.toString()+t.webGlExtensions.value.extensions.toString()+t.webGlExtensions.value.parameters.toString()+t.webGlExtensions.value.shaderPrecisions.toString()+t.fonts.value.toString()+t.webGlBasics.value.renderer+t.webGlBasics.value.rendererUnmasked+t.webGlBasics.value.shadingLanguageVersion+t.webGlBasics.value.vendor+t.webGlBasics.value.vendorUnmasked+t.webGlBasics.value.version+t.canvas.value.geometry).then((e=>{Skl_vistorID=e}))}))};function detectAdsId(){const e=parentUrl.split("&"),t=e?.find((e=>e.indexOf("utm_source")>-1));t&&(t.indexOf("facebook")>-1&&(adsClickId=e.find((e=>e.indexOf("fbclid")>-1))),(t.indexOf("youtube")>-1||t.indexOf("google")>-1)&&(adsClickId=e.find((e=>e.indexOf("gclid")>-1))),t.indexOf("tiktok")>-1&&(adsClickId=e.find((e=>e.indexOf("ttclid")>-1))),third_id=adsClickId?.split("=")[1])}function countViewPage(){const e="3rd_id",t="Count_3rd_id";third_id&&!localStorage.getItem(e)&&localStorage.setItem(e,third_id),third_id&&(localStorage.getItem(e)!=third_id?Change_3rd_id=!0:localStorage.getItem(t)?localStorage.setItem(t,Number(localStorage.getItem(t))+1):localStorage.setItem(t,Count_3rd_id))}function listenPhoneValidate(){fieldPhone.addEventListener("input",(e=>{regexPhone.test(e.target.value)&&syncToSheetValidate({phone:e.target.value,link:parentUrl})}))}function handleCountNameTyping(){var e=0,t=0;fieldName.addEventListener("input",(function(e){Count_na_keyboard++})),fieldName.addEventListener("keydown",(function(n){8===n.keyCode&&(e++,Count_na_delete_keyboard.push(`${e}-${t}`),t=1)})),fieldName.addEventListener("mouseup",(function(e){0==(t=e.target.selectionEnd-e.target.selectionStart)&&(t=1)}))}function handleCountPhoneTyping(){var e=0,t=0;fieldPhone.addEventListener("input",(function(e){Count_po_keyboard+=1})),fieldPhone.addEventListener("keydown",(function(n){8===n.keyCode&&(e++,Count_po_delete_keyboard.push(`${e}-${t}`),t=1)})),fieldPhone.addEventListener("mouseup",(function(e){0==(t=e.target.selectionEnd-e.target.selectionStart)&&(t=1)}))}FingerprintJS.load().then((async e=>await e.get({extendedResult:!0}))).then((e=>{const t=e.components;getHash(t.deviceMemory.value+t.audio.value+t.webGlExtensions.value.contextAttributes.toString()+t.webGlExtensions.value.extensionParameters.toString()+t.webGlExtensions.value.extensions.toString()+t.webGlExtensions.value.parameters.toString()+t.webGlExtensions.value.shaderPrecisions.toString()+t.fonts.value.toString()+t.webGlBasics.value.renderer+t.webGlBasics.value.rendererUnmasked+t.webGlBasics.value.shadingLanguageVersion+t.webGlBasics.value.vendor+t.webGlBasics.value.vendorUnmasked+t.webGlBasics.value.version+t.canvas.value.geometry).then((e=>{Skl_vistorID=e}))})),detectAdsId(),countViewPage(),listenPhoneValidate(),handleCountNameTyping(),handleCountPhoneTyping();var timeNaIn=0,timePoIn=0,timeNaOut=0,timePoOut=0,timeAdIn=0,timeAdOut=0;function setTimer(){fieldName?.addEventListener("click",(function(e){timeNaIn||(timeNaIn=new Date),window.visualViewport.addEventListener("resize",listenerKeyboardOpen)})),fieldName?.addEventListener("focusout",(function(e){timeNaOut=new Date})),fieldPhone?.addEventListener("click",(function(e){timePoIn||(timePoIn=new Date),window.visualViewport.addEventListener("resize",listenerKeyboardOpen)})),fieldPhone?.addEventListener("focusout",(function(e){timePoOut=new Date}))}function inputTiming(){var e=Math.abs(timeNaOut-timeNaIn)/1e3;return{Action_po_time:Math.abs(timePoOut-timePoIn)/1e3,Action_na_time:e,Action_po_to_submit:Math.abs((+new Date-+timePoOut)/1e3),Action_time:Math.abs(new Date-timeFirstRenderPage)/1e3,Action_form_time:timeNaIn<timePoIn?Math.abs(new Date-timeNaIn)/1e3:Math.abs(new Date-timePoIn)/1e3}}async function syncToSheetValidate({phone:e,link:t}){t=t.indexOf("&")>-1?t.replaceAll("&","_SKYCOM_"):t,await fetch(`${urlSyncGoogleSheetSpam}?phone=${e}&link=${t}&SHEET_NAME=SDTValidate`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})}async function syncToSheetServerFail({name:e,phone:t,ad_channel:n,ad_account:o,link:i,reasons:a}){i=i.indexOf("&")>-1?i.replaceAll("&","_SKYCOM_"):i,await fetch(`${urlSyncGoogleSheetSpam}?time=${timeFirstRenderPage.toLocaleDateString()}-${timeFirstRenderPage.toLocaleTimeString()}&name=${e}&phone=${t}&utmSource=${n||""}&utmMedium=${o||""}&link=${i}&reasons=${a}&SHEET_NAME=ErrorServer`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})}async function syncToSheetDataSubmit({name:e,phone:t,ad_channel:n,ad_account:o,link:i,spam:a,reasons:d}){i=i.indexOf("&")>-1?i.replaceAll("&","_SKYCOM_"):i,await fetch(`${urlSyncGoogleSheetSpam}?time=${timeFirstRenderPage.toLocaleDateString()}-${timeFirstRenderPage.toLocaleTimeString()}&name=${e}&phone=${t}&utmSource=${n||""}&utmMedium=${o||""}&link=${i}&spam=${a}&reasons=${d}&SHEET_NAME=TotalSDT`,{method:"GET",mode:"no-cors",headers:{"Content-Type":"application/json"},redirect:"follow"})}async function handlePostData({Ten1:e,Ten2:t,name:n,phone:o,Count_na_keyboard:i,Action_na_time:a,Is_open_na_keyboard:d,Count_na_delete_keyboard:r,Count_po_keyboard:s,Action_po_time:c,Action_po_to_submit:l,Is_open_po_keyboard:u,Count_po_delete_keyboard:_,Action_time:m,Action_form_time:h,Sceensize:p,Touch_pixel:g,Is_device_motion_change:b,Count_3rd_id:f,Change_3rd_id:y,Skl_vistorID:v,visitorId:S}){const k={Ten1:e,Ten2:t,name:n,phone:o,link:parentUrl,Count_na_keyboard:i,Action_na_time:a,Is_open_na_keyboard:d,Count_na_delete_keyboard:r,Count_po_keyboard:s,Action_po_time:c,Action_po_to_submit:l,Is_open_po_keyboard:u,Count_po_delete_keyboard:_,Action_time:m,Action_form_time:h,Sceensize:p,Touch_pixel:g,Is_device_motion_change:b,Count_3rd_id:f,Change_3rd_id:y,Skl_vistorID:v,visitorId:S};await fetch(bareURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)}).then((function(e){return e.json()})).then((async function(n){await syncToSheetDataSubmit({name:e,phone:t,link:parentUrl,spam:n.spam,reasons:n.reasons,ad_channel:n.ad_channel,ad_account:n.ad_account}),n.spam?window.parent.location.replace(urlThankFake):window.parent.location.replace(`${urlThankReal}?name=${e}&phone=${t}`)})).catch((async function(n){await syncToSheetServerFail({name:e,phone:t,link:parentUrl,reason:n.message,ad_channel:data.ad_channel,ad_account:data.ad_account})}))}function validateForm(){const e=fieldPhone.value;let t=!0;return regexPhone.test(e)||(document.getElementById("errorMessage").innerText="Vui lòng nhập đúng định dạng số điện thoại",t=!1),t}function handleSubmit(){form.addEventListener("submit",(e=>{e.preventDefault();if(validateForm()){const{Action_na_time:e,Action_po_time:t,Action_po_to_submit:n,Action_time:o,Action_form_time:i}=inputTiming(),a=fieldName.value,d=fieldPhone.value,r=document.getElementById("ten2").value,s=document.getElementById("sdt2").value;Sceensize=`${window.screen.width} x ${window.screen.height}`,Count_3rd_id=localStorage.getItem("Count_3rd_id"),buttonSubmit.innerText="ĐANG XỬ LÝ!!!",buttonSubmit.parentElement.classList.add("disable"),overlay.classList.add("active"),handlePostData({Ten1:a,Ten2:d,name:r,phone:s,Count_na_keyboard:Count_na_keyboard,Action_na_time:e,Is_open_na_keyboard:Is_open_na_keyboard,Count_na_delete_keyboard:Count_na_delete_keyboard,Count_po_keyboard:Count_po_keyboard,Action_po_time:t,Action_po_to_submit:n,Is_open_po_keyboard:Is_open_po_keyboard,Count_po_delete_keyboard:Count_po_delete_keyboard,Action_time:o,Action_form_time:i,Sceensize:Sceensize,Touch_pixel:Touch_pixel,Is_device_motion_change:Is_device_motion_change,Count_3rd_id:Count_3rd_id,Change_3rd_id:Change_3rd_id,Skl_vistorID:Skl_vistorID,visitorId:visitorId})}}))}setTimer(),handleSubmit();